<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AI Model Comparison for Vendor Recognition</title>
    <link rel="stylesheet" href="/static/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>AI Model Comparison for Vendor Notices</h1>
        </header>
        <div class="top-actions">
            <button class="download-pdf-btn" onclick="window.print()">
                Download Full Report (PDF)
            </button>
            <button class="download-pdf-btn" onclick="downloadStandaloneHTML()" style="margin-left: 10px; background: #059669;">
                Download Standalone HTML
            </button>
        </div>
        <nav class="tab-bar">
            <button class="tab active" data-tab="dashboard">Dashboard</button>
            <button class="tab" data-tab="gemini">Gemini 2.5 Flash</button>
            <button class="tab" data-tab="gpt51">GPT 5.1</button>
            <button class="tab" data-tab="gpt5mini">GPT 5-mini</button>
            <button class="tab" data-tab="overall">Overall</button>
        </nav>

        <section id="dashboard" class="tab-content active">
            <h2>Vendor Recognition Accuracy</h2>
            <canvas id="accuracyChart"></canvas>


            <h3 class="detailed-heading">Classification Accuracy</h3>
            <div style="width: 95%; height: 450px; padding: 20px; background: #ffffff; border-radius: 12px; box-shadow: 0 1px 6px rgba(0,0,0,0.05);">
                <h4 style="margin: 0 0 12px 0; font-size: 0.95rem; color: #2a4d69;">Notice Category Classification Accuracy (%)</h4>
                <p style="margin: 0 0 12px 0; font-size: 0.85rem; color: #64748b;">Shows how accurately each model classifies notices into their correct category</p>
                <div style="position: relative; width: 100%; height: 340px;">
                    <canvas id="categoryAccuracyChart"></canvas>
                </div>
            </div>
            <h3 class="detailed-heading">Notice Date Recognition Accuracy</h3>
            <div class="chart-grid">
                <div class="chart-card" style="width: 420px; min-height: 260px;">
                    <canvas id="noticeDateChart" style="width: 100%; height: 220px;"></canvas>
                </div>
            </div>

<div class="chart-grid" style="display: flex; gap: 20px; flex-wrap: wrap;">
    
    <div class="chart-card" style="width: 420px; height: 260px;">
        <h3 class="detailed-heading">Impact Amount Accuracy</h3>
        <canvas id="disconnectLateChart"></canvas>
    </div>

    <div class="chart-card" style="width: 420px;height: 260px;">
        <h3 class="detailed-heading">Impact Date Accuracy</h3>
        <canvas id="impactDateChart"></canvas>
    </div>
</div>
<br>

        </section>

        <section id="gemini" class="tab-content">
            <h2>Gemini 2.5 Flash Comparison Report</h2>

            <div style="margin-bottom: 16px; display: flex; gap: 8px; align-items: center; flex-wrap: wrap;">
                <input id="testingPdfUpload" type="file" accept="application/pdf" multiple style="font-size: 0.9rem;" />
                <button onclick="uploadTestingPdfs()" style="padding: 8px 14px; border-radius: 6px; border: none; background: #0f766e; color: white; font-size: 0.9rem; cursor: pointer;">
                    Upload PDFs to Database
                </button>
                <button onclick="runBulkTestingGemini()" style="padding: 8px 14px; border-radius: 6px; border: none; background: #4169e1; color: white; font-size: 0.9rem; cursor: pointer;">
                    Run Bulk Testing & Compare
                </button>
                <button onclick="loadGeminiComparison()" style="padding: 8px 14px; border-radius: 6px; border: 1px solid #cbd5e1; background: #ffffff; color: #1e293b; font-size: 0.9rem; cursor: pointer;">
                    Refresh Comparison Only
                </button>
                <span id="testingStatusGemini" style="font-size: 0.85rem; color: #64748b;"></span>
                <div id="geminiFullCorrectSummary" style="margin: 8px 0; font-weight: 500;"></div>
            </div>
            <div style="margin-top: 10px; margin-bottom: 15px; display: flex; gap: 8px; align-items: center;">
                <select id="geminiSearchType" style="padding: 6px; border: 1px solid #ccc; border-radius: 4px; outline: none;">
                    <option value="category">Notice Type</option>
                    <option value="3">Vendor Account</option>
                    <option value="4">Vendor Name</option>
                    <option value="5">Service Address</option>
                   

                </select>
                <input type="text" id="geminiSearchInput" placeholder="Gemini 2.5 Flash" style="padding: 6px; border: 1px solid #ccc; border-radius: 4px; outline: none;">
                <select id="geminiCategorySelect" style="padding: 6px; border: 1px solid #ccc; border-radius: 4px; outline: none; display: none;">
                    <option value="">-- Select Notice Type --</option>
                </select>
                <div onclick="filterGeminiTable()" style="cursor: pointer; padding: 4px; display: flex; align-items: center;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#333" viewBox="0 0 16 16">
                        <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z" />
                    </svg>
                </div>
                <div style="margin-bottom: 10px; display: flex; align-items: center; gap: 6px;">
                    <input type="checkbox" id="geminiShowMismatchOnly" onchange="toggleMismatchFilter('testingComparisonBodyGemini', this.checked)" style="cursor: pointer;">
                    <label for="geminiShowMismatchOnly" style="cursor: pointer; font-size: 0.9rem; color: #1e293b;">Show only mismatched rows</label>
                </div>
            </div>

            <!-- TOP PAGINATION for Gemini -->
            <div class="pagination-container" id="geminiPaginationTop" style="margin: 15px 0; display: flex; justify-content: center; align-items: center; gap: 10px;">
                <button onclick="changePage('gemini', -1)" style="padding: 6px 12px; cursor: pointer;">Previous</button>
                <span id="geminiPageInfo" style="font-size: 0.9rem; color: #1e293b;">Page 1</span>
                <button onclick="changePage('gemini', 1)" style="padding: 6px 12px; cursor: pointer;">Next</button>
            </div>


            <div class="table-container">
                <table class="report-table">
                    <thead>
                        <tr>
                            <th rowspan="2">S.No</th>
                            <th rowspan="2">PDF Name</th>
                            <th rowspan="2">Model</th>
                            <th colspan="3">Vendor Recognition</th>
                            <th rowspan="2">Vendor Identification</th>
                            <th rowspan="2">Category</th>
                            <th rowspan="2">Notice Date</th>
                            <th rowspan="2">Impact Date</th>
                            <th rowspan="2">Impact Amount</th>
                        </tr>
                        <tr>
                            <th>Vendor Account</th>
                            <th>Vendor Name</th>
                            <th>Service Address</th>
                        </tr>
                    </thead>
                    <tbody id="testingComparisonBodyGemini">
                        </tbody>
                </table>
            </div>
            <!-- BOTTOM PAGINATION for Gemini -->
        <div class="pagination-container" id="geminiPaginationBottom" style="margin: 15px 0; display: flex; justify-content: center; align-items: center; gap: 10px;">
            <button onclick="changePage('gemini', -1)" style="padding: 6px 12px; cursor: pointer;">Previous</button>
            <span id="geminiPageInfoBottom" style="font-size: 0.9rem; color: #1e293b;">Page 1</span>
            <button onclick="changePage('gemini', 1)" style="padding: 6px 12px; cursor: pointer;">Next</button>
        </div>

        </section>

        <section id="overall" class="tab-content">
            <h2>Overall Test Report</h2>
            <div style="margin-top: 10px; margin-bottom: 15px; display: flex; gap: 8px; align-items: center;">
                <select id="overallSearchType" style="padding: 6px; border: 1px solid #ccc; border-radius: 4px; outline: none;">
                    <option value="category">Notice Type</option>
                    <option value="3">Vendor Account</option>
                    <option value="4">Vendor Name</option>
                    <option value="5">Service Address</option>
                <input type="text" id="overallSearchInput" placeholder="Search Overall Results" style="padding: 6px; border: 1px solid #ccc; border-radius: 4px; outline: none;">
                <select id="overallCategorySelect" style="padding: 6px; border: 1px solid #ccc; border-radius: 4px; outline: none; display: none;">
                    <option value="">-- Select Notice Type --</option>
                </select>

                <div onclick="filterOverallTable()" style="cursor: pointer; padding: 4px; display: flex; align-items: center;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#333" viewBox="0 0 16 16">
                        <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z" />
                    </svg>
                </div>
                <div style="margin-bottom: 10px; display: flex; align-items: center; gap: 6px;">
                    <input type="checkbox" id="overallShowMismatchOnly" onchange="toggleMismatchFilter('testingComparisonBodyOverall', this.checked)" style="cursor: pointer;">
                    <label for="overallShowMismatchOnly" style="cursor: pointer; font-size: 0.9rem; color: #1e293b;">Show only mismatched rows</label>
                </div>
            </div>

            <!-- TOP PAGINATION for Overall -->
            <div class="pagination-container" id="overallPaginationTop" style="margin: 15px 0; display: flex; justify-content: center; align-items: center; gap: 10px;">
                <button onclick="changePage('overall', -1)" style="padding: 6px 12px; cursor: pointer;">Previous</button>
                <span id="overallPageInfo" style="font-size: 0.9rem; color: #1e293b;">Page 1</span>
                <button onclick="changePage('overall', 1)" style="padding: 6px 12px; cursor: pointer;">Next</button>
            </div>


            <div class="table-container">
                <table class="report-table">
                    <thead>
                        <tr>
                            <th rowspan="2">S.No</th>
                            <th rowspan="2">PDF Name</th>
                            <th rowspan="2">Model</th>
                            <th colspan="3">Vendor Identification</th>
                            <th rowspan="2">Vendor Details Verified</th>
                            <th rowspan="2">Category</th>
                            <th rowspan="2">Notice Date</th>
                            <th rowspan="2">Impact Date</th>
                            <th rowspan="2">Impact Amount</th>
                        </tr>
                        <tr>
                            <th>Vendor Account</th>
                            <th>Vendor Name</th>
                            <th>Service Address</th>
                        </tr>
                    </thead>
                    <tbody id="testingComparisonBodyOverall">
                    </tbody>
                </table>
            </div>
            <!-- BOTTOM PAGINATION for Overall -->
            <div class="pagination-container" id="overallPaginationBottom" style="margin: 15px 0; display: flex; justify-content: center; align-items: center; gap: 10px;">
                <button onclick="changePage('overall', -1)" style="padding: 6px 12px; cursor: pointer;">Previous</button>
                <span id="overallPageInfoBottom" style="font-size: 0.9rem; color: #1e293b;">Page 1</span>
                <button onclick="changePage('overall', 1)" style="padding: 6px 12px; cursor: pointer;">Next</button>
            </div>

        </section>

        <section id="gpt51" class="tab-content">
            <h2>GPT 5.1 Comparison Report</h2>

            <div style="margin-bottom: 16px; display: flex; gap: 8px; align-items: center; flex-wrap: wrap;">
                <input id="testingPdfUpload" type="file" accept="application/pdf" multiple style="font-size: 0.9rem;" />
                <button onclick="uploadTestingPdfs()" style="padding: 8px 14px; border-radius: 6px; border: none; background: #0f766e; color: #ffffff; font-size: 0.9rem; cursor: pointer;">
                    Upload PDFs to Database
                </button>
                <button onclick="runBulkTestingGpt51()" style="padding: 8px 14px; border-radius: 6px; border: none; background: #4169e1; color: #ffffff; font-size: 0.9rem; cursor: pointer;">
                    Run GPT 5.1 bulk testing
                </button>
                <button onclick="loadGpt51Comparison()" style="padding: 8px 14px; border-radius: 6px; border: 1px solid #cbd5e1; background: #ffffff; color: #1e293b; font-size: 0.9rem; cursor: pointer;">
                    Refresh Comparison Only
                </button>
                <span id="testingStatusGpt51" style="font-size: 0.85rem; color: #64748b"></span>
                <div id="gpt51FullCorrectSummary" style="margin: 8px 0; font-weight: 500;"></div>
            </div>
            <div style="margin-top: 10px; margin-bottom: 15px; display: flex; gap: 8px; align-items: center;">
                <select id="gpt51SearchType" style="padding: 6px; border: 1px solid #ccc; border-radius: 4px; outline: none;">
                    <option value="category">Notice Type</option>
                    <option value="3">Vendor Account</option>
                    <option value="4">Vendor Name</option>
                    <option value="5">Service Address</option>
                    <!-- <option value="category">Notice Type</option> -->
                </select>
                <input type="text" id="gpt51SearchInput" placeholder="Search GPT 5.1 Results" style="padding: 6px; border: 1px solid #ccc; border-radius: 4px; outline: none;">
                <select id="gpt51CategorySelect" style="padding: 6px; border: 1px solid #ccc; border-radius: 4px; outline: none; display: none;">
                    <option value="">-- Select Notice Type --</option>
                </select>

                <div onclick="filterGpt51Table()" style="cursor: pointer; padding: 4px; display: flex; align-items: center;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#333" viewBox="0 0 16 16">
                        <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z" />
                    </svg>
                </div>
                <div style="margin-bottom: 10px; display: flex; align-items: center; gap: 6px;">
                    <input type="checkbox" id="gpt51ShowMismatchOnly" onchange="toggleMismatchFilter('testingComparisonBodyGpt51', this.checked)" style="cursor: pointer;">
                    <label for="gpt51ShowMismatchOnly" style="cursor: pointer; font-size: 0.9rem; color: #1e293b;">Show only mismatched rows</label>
                </div>
            </div>

            <!-- TOP PAGINATION for GPT 5.1 -->
            <div class="pagination-container" id="gpt51PaginationTop" style="margin: 15px 0; display: flex; justify-content: center; align-items: center; gap: 10px;">
                <button onclick="changePage('gpt51', -1)" style="padding: 6px 12px; cursor: pointer;">Previous</button>
                <span id="gpt51PageInfo" style="font-size: 0.9rem; color: #1e293b;">Page 1</span>
                <button onclick="changePage('gpt51', 1)" style="padding: 6px 12px; cursor: pointer;">Next</button>
            </div>

            <div class="table-container">
                <table class="report-table">
                    <thead>
                        <tr>
                            <th rowspan="2">S.No</th>
                            <th rowspan="2">PDF Name</th>
                            <th rowspan="2">Model</th>
                            <th colspan="3">Vendor Identification</th>
                            <th rowspan="2">Vendor Details Verified</th>
                            <th rowspan="2">Category</th>
                            <th rowspan="2">Notice Date</th>
                            <th rowspan="2">Impact Date</th>
                            <th rowspan="2">Impact Amount</th>
                        </tr>
                        <tr>
                            <th>Vendor Account</th>
                            <th>Vendor Name</th>
                            <th>Service Address</th>
                        </tr>
                    </thead>
                    <tbody id="testingComparisonBodyGpt51">
                    </tbody>
                </table>
            </div>
            <!-- BOTTOM PAGINATION for GPT 5.1 -->
            <div class="pagination-container" id="gpt51PaginationBottom" style="margin: 15px 0; display: flex; justify-content: center; align-items: center; gap: 10px;">
                <button onclick="changePage('gpt51', -1)" style="padding: 6px 12px; cursor: pointer;">Previous</button>
                <span id="gpt51PageInfoBottom" style="font-size: 0.9rem; color: #1e293b;">Page 1</span>
                <button onclick="changePage('gpt51', 1)" style="padding: 6px 12px; cursor: pointer;">Next</button>
            </div>

        </section>

        <section id="gpt5mini" class="tab-content">
            <h2>GPT 5-mini Comparison Report</h2>

            <div style="margin-bottom: 16px; display: flex; gap: 8px; align-items: center; flex-wrap: wrap;">
                <input id="testingPdfUpload" type="file" accept="application/pdf" multiple style="font-size: 0.9rem;" />
                <button onclick="uploadTestingPdfs()" style="padding: 8px 14px; border-radius: 6px; border: none; background: #0f766e; color: #ffffff; font-size: 0.9rem; cursor: pointer;">
                    Upload PDFs to Database
                </button>
                <button onclick="runBulkTestingGpt5Mini()" style="padding: 8px 14px; border-radius: 6px; border: none; background: #4169e1; color: #ffffff; font-size: 0.9rem; cursor: pointer;">
                    Run GPT 5-mini bulk testing
                </button>
                <button onclick="loadGpt5MiniComparison()" style="padding: 8px 14px; border-radius: 6px; border: 1px solid #cbd5e1; background: #ffffff; color: #1e293b; font-size: 0.9rem; cursor: pointer;">
                    Refresh Comparison Only
                </button>
                <span id="testingStatusGpt5Mini" style="font-size: 0.85rem; color: #64748b"></span>
                <div id="gpt5miniFullCorrectSummary" style="margin: 8px 0; font-weight: 500;"></div>
            </div>

            <div style="margin-top: 10px; margin-bottom: 15px; display: flex; gap: 8px; align-items: center;">
                <select id="gpt5miniSearchType" style="padding: 6px; border: 1px solid #ccc; border-radius: 4px; outline: none;">
                    <option value="category">Notice Type</option>
                    <option value="3">Vendor Account</option>
                    <option value="4">Vendor Name</option>
                    <option value="5">Service Address</option>
                    
                </select>
                <input type="text" id="gpt5miniSearchInput" placeholder="Search GPT 5-mini Results" style="padding: 6px; border: 1px solid #ccc; border-radius: 4px; outline: none;">
                <select id="gpt5miniCategorySelect" style="padding: 6px; border: 1px solid #ccc; border-radius: 4px; outline: none; display: none;">
                    <option value="">-- Select Notice Type --</option>
                </select>
                <div onclick="filterGpt5MiniTable()" style="cursor: pointer; padding: 4px; display: flex; align-items: center;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#333" viewBox="0 0 16 16">
                        <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z" />
                    </svg>
                </div>
                <div style="margin-bottom: 10px; display: flex; align-items: center; gap: 6px;">
                    <input type="checkbox" id="gpt5miniShowMismatchOnly" onchange="toggleMismatchFilter('testingComparisonBodyGpt5Mini', this.checked)" style="cursor: pointer;">
                    <label for="gpt5miniShowMismatchOnly" style="cursor: pointer; font-size: 0.9rem; color: #1e293b;">Show only mismatched rows</label>
                </div>
            </div>

            <!-- TOP PAGINATION for GPT 5-mini -->
            <div class="pagination-container" id="gpt5miniPaginationTop" style="margin: 15px 0; display: flex; justify-content: center; align-items: center; gap: 10px;">
                <button onclick="changePage('gpt5mini', -1)" style="padding: 6px 12px; cursor: pointer;">Previous</button>
                <span id="gpt5miniPageInfo" style="font-size: 0.9rem; color: #1e293b;">Page 1</span>
                <button onclick="changePage('gpt5mini', 1)" style="padding: 6px 12px; cursor: pointer;">Next</button>
            </div>
            <div class="table-container">
                <table class="report-table">
                    <thead>
                        <tr>
                            <th rowspan="2">S.No</th>
                            <th rowspan="2">PDF Name</th>
                            <th rowspan="2">Model</th>
                            <th colspan="3">Vendor Identification</th>
                            <th rowspan="2">Vendor Details Verified</th>
                            <th rowspan="2">Category</th>
                            <th rowspan="2">Notice Date</th>
                            <th rowspan="2">Impact Date</th>
                            <th rowspan="2">Impact Amount</th>
                        </tr>
                        <tr>
                            <th>Vendor Account</th>
                            <th>Vendor Name</th>
                            <th>Service Address</th>
                        </tr>
                    </thead>
                    <tbody id="testingComparisonBodyGpt5Mini">
                    </tbody>
                </table>
            </div>
            <!-- BOTTOM PAGINATION for GPT 5-mini -->
            <div class="pagination-container" id="gpt5miniPaginationBottom" style="margin: 15px 0; display: flex; justify-content: center; align-items: center; gap: 10px;">
                <button onclick="changePage('gpt5mini', -1)" style="padding: 6px 12px; cursor: pointer;">Previous</button>
                <span id="gpt5miniPageInfoBottom" style="font-size: 0.9rem; color: #1e293b;">Page 1</span>
                <button onclick="changePage('gpt5mini', 1)" style="padding: 6px 12px; cursor: pointer;">Next</button>
            </div>

        </section>
    </div>

    <script>
        // Tab switching
        const tabs = document.querySelectorAll('.tab');
        const contents = document.querySelectorAll('.tab-content');
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                tabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                contents.forEach(c => c.classList.remove('active'));
                document.getElementById(tab.dataset.tab).classList.add('active');
            });
        });

        // Register datalabels plugin
        Chart.register(ChartDataLabels);

        // Bar Chart for Dashboard - Dynamic
        const ctx = document.getElementById('accuracyChart').getContext('2d');
        let accuracyChart;

        async function loadAccuracyChart() {
            console.log('Loading accuracy chart...');
            try {
                const resp = await fetch('http://localhost:9000/testing/analytics/overall-accuracy');
                const data = await resp.json();
                console.log('Data received:', data);

                const chartData = [data.gemini, data.gpt_5_1, data.gpt_5_mini];

                if (accuracyChart) {
                    accuracyChart.destroy();
                }

                accuracyChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Gemini 2.5 Flash', 'GPT 5.1', 'GPT 5-mini'],
                        datasets: [{
                            label: 'Accuracy (%)',
                            data: chartData,
                            backgroundColor: ['#fb332c', '#32cd32', '#ff8c00'],
                            borderRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { display: false },
                            title: { display: false },
                            datalabels: {
                                anchor: 'end',
                                align: 'end',
                                offset: 4,
                                formatter: (value) => value + "%",
                                font: { weight: 'bold', size: 11 },
                                color: '#2a4d69'
                            }
                        },
                        scales: {
                            y: { beginAtZero: true, max: 100 }
                        }
                    }
                });
                console.log('Chart created successfully');
            } catch (e) {
                console.error('Failed to load accuracy chart:', e);
            }
        }

// Disconnect vs Late Notice – impact date & amount accuracy - Dynamic
const disconnectLateCtx = document.getElementById('disconnectLateChart').getContext('2d');
let disconnectLateChart;

async function loadDisconnectLateChart() {
    console.log('Loading disconnect/late chart...');
    try {
        const resp = await fetch('http://localhost:9000/testing/analytics/disconnect-late-accuracy');
        const data = await resp.json();
        console.log('Disconnect/Late data received:', data);

        const chartData = [data.gemini, data.gpt_5_1, data.gpt_5_mini];

        // Colors per model (order must match labels and chartData)
        const barColors = ['#fb332c', '#32cd32', '#ff8c00'];
        const borderColors = ['#fb332c', '#2aa52a', '#cc7000']; // optional

        if (disconnectLateChart) {
            disconnectLateChart.destroy();
        }

        disconnectLateChart = new Chart(disconnectLateCtx, {
            type: 'bar',
            data: {
                labels: ['Gemini 2.5 Flash', 'GPT 5.1', 'GPT 5-mini'],
                datasets: [{
                    label: 'Disconnect & Late Notice Accuracy (%)',
                    data: chartData,
                    backgroundColor: barColors,    // <- separate colors
                    borderColor: borderColors,     // optional outline
                    borderWidth: 1,                // optional
                    borderRadius: 6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    datalabels: {
                        anchor: 'end',
                        align: 'end',
                        offset: 4,
                        formatter: (value) => value + "%",
                        font: { weight: 'bold', size: 11 },
                        color: '#2a4d69'
                    },
                    tooltip: {
                        callbacks: {
                            label: (ctx) => `${ctx.dataset.label}: ${ctx.parsed.y}%`
                        }
                    }
                },
                layout: {
                    padding: { top: 20 }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        title: {
                            display: true,
                            text: 'Accuracy (%)'
                        }
                    }
                }
            }
        });

        console.log('Disconnect/Late chart created successfully');
    } catch (e) {
        console.error('Failed to load disconnect/late chart:', e);
    }
}
// Impact Date Accuracy
const impactDateCtx = document.getElementById('impactDateChart').getContext('2d');
let impactDateChart;

async function loadImpactDateChart() {
    console.log('Loading impact date chart...');
    try {
        const resp = await fetch('http://localhost:9000/testing/analytics/impact-date');
        const data = await resp.json();
        console.log('Impact date data received:', data);

        const chartData = [data.gemini, data.gpt_5_1, data.gpt_5_mini];

        // Colors per model
        const barColors = ['#fb332c', '#32cd32', '#ff8c00'];

        if (impactDateChart) {
            impactDateChart.destroy();
        }

        impactDateChart = new Chart(impactDateCtx, {
            type: 'bar',
            data: {
                labels: ['Gemini 2.5 Flash', 'GPT 5.1', 'GPT 5-mini'],
                datasets: [{
                    label: 'Impact Date Accuracy (%)',
                    data: chartData,
                    backgroundColor: barColors, // <-- separate colors
                    borderRadius: 6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    datalabels: {
                        anchor: 'end',
                        align: 'end',
                        offset: 4,
                        formatter: (value) => value + "%",
                        font: { weight: 'bold', size: 11 },
                        color: '#2a4d69'
                    }
                },
                layout: {
                    padding: { top: 20 }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        title: {
                            display: true,
                            text: 'Accuracy (%)'
                        }
                    }
                }
            }
        });
        console.log('Impact date chart created successfully');
    } catch (e) {
        console.error('Failed to load impact date chart:', e);
    }
}
// Notice Date Recognition Accuracy for All Notice Types

const noticeDateCtx = document.getElementById('noticeDateChart').getContext('2d');
let noticeDateChart;

async function loadNoticeDateChart() {
    console.log('Loading notice date chart...');
    try {
        const resp = await fetch('http://localhost:9000/testing/analytics/notice-date-accuracy');
        const data = await resp.json();
        console.log('Notice date data received:', data);

        const chartData = [data.gemini, data.gpt_5_1, data.gpt_5_mini];

        // Colors per model (order must match labels and chartData)
        const barColors = ['#fb332c', '#32cd32', '#ff8c00'];
        const borderColors = ['#fb332c', '#2aa52a', '#cc7000']; // optional darker borders

        if (noticeDateChart) {
            noticeDateChart.destroy();
        }

        noticeDateChart = new Chart(noticeDateCtx, {
            type: 'bar',
            data: {
                labels: ['Gemini 2.5 Flash', 'GPT 5.1', 'GPT 5-mini'],
                datasets: [{
                    label: 'Notice Date Accuracy (%)',
                    data: chartData,
                    backgroundColor: barColors,
                    borderColor: borderColors,      // optional
                    borderWidth: 1,                 // optional
                    borderRadius: 6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    datalabels: {
                        anchor: 'end',
                        align: 'end',
                        offset: 4,
                        formatter: (value) => value + "%",
                        font: { weight: 'bold', size: 11 },
                        color: '#2a4d69'
                    },
                    tooltip: {
                        callbacks: {
                            label: (ctx) => `${ctx.dataset.label}: ${ctx.parsed.y}%`
                        }
                    }
                },
                layout: {
                    padding: { top: 20 }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        title: {
                            display: true,
                            text: 'Accuracy (%)'
                        }
                    }
                }
            }
        });
        console.log('Notice date chart created successfully');
    } catch (e) {
        console.error('Failed to load notice date chart:', e);
    }
}
// Category-wise Accuracy Comparison - Dynamic
        const categoryAccuracyCtx = document.getElementById('categoryAccuracyChart').getContext('2d');
let categoryAccuracyChart;

async function loadCategoryChart() {
    console.log('Loading category chart...');
    try {
        const resp = await fetch('http://localhost:9000/testing/analytics/category-accuracy');
        const data = await resp.json();
        console.log('Category data received:', data);
        console.log('Categories:', data.categories);
        console.log('Gemini data:', data.gemini_accuracy || data.gemini);
        console.log('GPT 5.1 data:', data.gpt_5_1_accuracy || data.gpt_5_1);
        console.log('GPT 5-mini data:', data.gpt_5_mini_accuracy || data.gpt_5_mini);

        // Support both old and new data formats
        const geminiData = data.gemini_accuracy || data.gemini || [];
        const gpt51Data = data.gpt_5_1_accuracy || data.gpt_5_1 || [];
        const gpt5miniData = data.gpt_5_mini_accuracy || data.gpt_5_mini || [];

        if (categoryAccuracyChart) {
            categoryAccuracyChart.destroy();
        }

        categoryAccuracyChart = new Chart(categoryAccuracyCtx, {
            type: 'bar',
            data: {
                labels: data.categories || [],
                datasets: [
                    {
                        label: 'Gemini 2.5 Flash',
                        data: geminiData,
                        backgroundColor: '#fb332c',
                        borderRadius: 4
                    },
                    {
                        label: 'GPT 5.1',
                        data: gpt51Data,
                        backgroundColor: '#32cd32',
                        borderRadius: 4
                    },
                    {
                        label: 'GPT 5-mini',
                        data: gpt5miniData,
                        backgroundColor: '#ff8c00',
                        borderRadius: 4
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                layout: {
                    padding: {
                        top: 25,
                        bottom: 0,
                        left: 0,
                        right: 0
                    }
                },
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            font: { size: 12 },
                            padding: 15
                        }
                    },
                    datalabels: {
                        anchor: 'end',
                        align: 'end',
                        offset: 4,
                        formatter: (value) => {
                            if (value === null || value === undefined || value === 0) return '';
                            // ✅ Show integer without decimals, decimal with one place
                            return Number.isInteger(value) ? value + "%" : value.toFixed(1) + "%";
                        },
                        font: { weight: 'bold', size: 10 },
                        color: '#2a4d69'
                    },
                    tooltip: {
                        callbacks: {
                            label: (ctx) => {
                                const value = ctx.parsed.y;
                                if (value === null || value === undefined) return `${ctx.dataset.label}: N/A`;
                                // ✅ Same integer/decimal formatting for tooltip
                                const formatted = Number.isInteger(value) ? value : value.toFixed(1);
                                return `${ctx.dataset.label}: ${formatted}% accuracy`;
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        ticks: {
                            maxRotation: 0,
                            minRotation: 0,
                            font: { size: 11 }
                        },
                        title: {
                            display: true,
                            text: 'Notice Category',
                            font: { size: 12, weight: 'bold' },
                            padding: { top: 10 }
                        }
                    },
                    y: {
                        beginAtZero: true,
                        max: 100,
                        ticks: {
                            callback: function(value) {
                                return value + '%';
                            }
                        },
                        title: {
                            display: true,
                            text: 'Classification Accuracy (%)',
                            font: { size: 12, weight: 'bold' },
                            padding: { bottom: 10 }
                        }
                    }
                }
            }
        });
        console.log('Category chart created successfully');
        console.log('Chart datasets:', categoryAccuracyChart.data.datasets);
    } catch (e) {
        console.error('Failed to load category chart:', e);
    }
}
    </script>

    <script>
        async function loadComparisonIntoBody(url, tbodyId, expectThreeModels) {
            const tbody = document.getElementById(tbodyId);
            if (!tbody) return;

            tbody.innerHTML = '';

            try {
                const resp = await fetch(url);
                if (!resp.ok) {
                    console.error('Failed to load comparison results', resp.status);
                    return;
                }

                const results = await resp.json();

                results.forEach(item => {
                    const sNo = item.s_no;
                    const pdfName = item.pdf_name;
                    const rows = item.rows;

                    // Master row is always first
                    const masterRow = rows[0];

                    const trMaster = document.createElement('tr');
                    trMaster.innerHTML = `
                        <td>${sNo}</td>
                        <td>${pdfName}</td>
                        <td>${masterRow.model}</td>
                        <td>${masterRow.vendor_account}</td>
                        <td>${masterRow.vendor_name}</td>
                        <td>${masterRow.service_address}</td>
                        <td>-</td>
                        <td>${masterRow.category}</td>
                        <td>${masterRow.notice_date}</td>
                        <td>${masterRow.impact_date}</td>
                        <td>${masterRow.impact_amount}</td>
                    `;
                    tbody.appendChild(trMaster);

                    function appendModelRow(modelRow, mismatches, extraClass) {
                        const isIncorrect = modelRow.details_verified === 'incorrect';
                        const isMissing = modelRow.details_verified === 'missing';

                        const tr = document.createElement('tr');
                        if (isIncorrect) {
                            tr.classList.add('highlight-error');
                        }
                        if (extraClass) {
                            tr.classList.add(extraClass);
                        }

                        function cellHtml(fieldKey, value) {
                            const mismatch = mismatches[fieldKey] === true;
                            const cls = isMissing ?
                                'verified-missing' :
                                mismatch ?
                                'verified-incorrect' :
                                'verified-correct';
                            return `<td class="${cls}">${value}</td>`;
                        }

                        const statusSymbol = isMissing ? '-' : (isIncorrect ? '✗' : '✓');

                        tr.innerHTML = `
                            <td></td>
                            <td></td>
                            <td>${modelRow.model}</td>
                            ${cellHtml('Vendor Account Number', modelRow.vendor_account)}
                            ${cellHtml('Vendor Name', modelRow.vendor_name)}
                            ${cellHtml('Service Address', modelRow.service_address)}
                            <td>${statusSymbol}</td>
                            ${cellHtml('Notice Category', modelRow.category)}
                            ${cellHtml('Notice Date', modelRow.notice_date)}
                            ${cellHtml('Impact Date', modelRow.impact_date)}
                            ${cellHtml('Impact Amount', modelRow.impact_amount)}
                        `;
                        tbody.appendChild(tr);
                    }

                    if (expectThreeModels) {
                        const geminiRow = rows[1];
                        const gpt51Row = rows[2];
                        const gpt5MiniRow = rows[3];

                        appendModelRow(geminiRow, geminiRow.field_mismatches || {}, 'row-gemini');
                        appendModelRow(gpt51Row, gpt51Row.field_mismatches || {}, 'row-gpt51');
                        appendModelRow(gpt5MiniRow, gpt5MiniRow.field_mismatches || {}, 'row-gpt5mini');
                    } else {
                        // rows[1] is the only model row (Gemini-only / GPT-only)
                        const modelRow = rows[1];
                        appendModelRow(modelRow, modelRow.field_mismatches || {}, '');
                    }
                });
            } catch (e) {
                console.error('Error loading testing comparison', e);
            }
        }

        // Per-tab loaders

        async function loadGeminiComparison() {
            await loadComparisonIntoBody(
                'http://localhost:9000/testing/comparison-results-gemini',
                'testingComparisonBodyGemini', // ← NEW ID
                false
            );
        }

        async function loadGpt51Comparison() {
            await loadComparisonIntoBody(
                'http://localhost:9000/testing/comparison-results-gpt-5-1',
                'testingComparisonBodyGpt51',
                false
            );
        }

        async function loadGpt5MiniComparison() {
            await loadComparisonIntoBody(
                'http://localhost:9000/testing/comparison-results-gpt-5-mini',
                'testingComparisonBodyGpt5Mini',
                false
            );
        }

        async function loadOverallComparison() {
            await loadComparisonIntoBody(
                'http://localhost:9000/testing/comparison-results',
                'testingComparisonBodyOverall',
                true
            );
        }

        async function runBulkTestingGemini() {
            const statusEl = document.getElementById('testingStatusGemini');
            if (statusEl) {
                statusEl.textContent = 'Running Gemini bulk testing...';
                statusEl.style.color = '#64748b';
            }

            try {
                const resp = await fetch('http://localhost:9000/testing/bulk-process', {
                    method: 'POST'
                });

                if (!resp.ok) {
                    const data = await resp.json().catch(() => ({}));
                    if (statusEl) {
                        statusEl.textContent = data.detail || `Gemini bulk testing failed (status ${resp.status})`;
                        statusEl.style.color = '#b91c1c';
                    }
                    return;
                }

                const data = await resp.json();
                if (statusEl) {
                    statusEl.textContent =
                        `Gemini bulk done. Processed: ${data.processed}, Skipped: ${data.skipped}`;
                    statusEl.style.color = '#16a34a';
                }

                await loadGeminiComparison(); // reload table after Gemini only
            } catch (e) {
                console.error(e);
                if (statusEl) {
                    statusEl.textContent = 'Unexpected error while running Gemini bulk testing.';
                    statusEl.style.color = '#b91c1c';
                }
            }
        }

        async function runBulkTestingGpt51() {
            const statusEl = document.getElementById('testingStatusGpt51');
            if (statusEl) {
                statusEl.textContent = 'Running GPT 5.1 bulk testing...';
                statusEl.style.color = '#64748b';
            }

            try {
                const resp = await fetch('http://localhost:9000/testing/bulk-process-gpt-5-1', {
                    method: 'POST'
                });

                if (!resp.ok) {
                    const data = await resp.json().catch(() => ({}));
                    if (statusEl) {
                        statusEl.textContent = data.detail || `GPT 5.1 bulk testing failed (status ${resp.status})`;
                        statusEl.style.color = '#b91c1c';
                    }
                    return;
                }

                const data = await resp.json();
                if (statusEl) {
                    statusEl.textContent =
                        `GPT 5.1 bulk done. Processed: ${data.processed}, Skipped: ${data.skipped}`;
                    statusEl.style.color = '#16a34a';
                }
                // inside runBulkTestingGpt51(), after success:
                await loadGpt51Comparison();
            } catch (e) {
                console.error(e);
                if (statusEl) {
                    statusEl.textContent = 'Unexpected error while running GPT 5.1 bulk testing.';
                    statusEl.style.color = '#b91c1c';
                }
            }
        }

        async function runBulkTestingGpt5Mini() {
            const statusEl = document.getElementById('testingStatusGpt5Mini');
            if (statusEl) {
                statusEl.textContent = 'Running GPT 5-mini bulk testing...';
                statusEl.style.color = '#64748b';
            }

            try {
                const resp = await fetch('http://localhost:9000/testing/bulk-process-gpt-5-mini', {
                    method: 'POST'
                });

                if (!resp.ok) {
                    const data = await resp.json().catch(() => ({}));
                    if (statusEl) {
                        statusEl.textContent = data.detail || `GPT 5-mini bulk testing failed (status ${resp.status})`;
                        statusEl.style.color = '#b91c1c';
                    }
                    return;
                }

                const data = await resp.json();
                if (statusEl) {
                    statusEl.textContent =
                        `GPT 5-mini bulk done. Processed: ${data.processed}, Skipped: ${data.skipped}`;
                    statusEl.style.color = '#16a34a';
                }
                // inside runBulkTestingGpt51(), after success:
                await loadGpt5MiniComparison();
            } catch (e) {
                console.error(e);
                if (statusEl) {
                    statusEl.textContent = 'Unexpected error while running GPT 5-mini bulk testing.';
                    statusEl.style.color = '#b91c1c';
                }
            }
        }

        async function uploadTestingPdfs() {
            console.log('uploadTestingPdfs clicked');

            // Pick the input from the currently visible tab
            const activeTab = document.querySelector('.tab-content.active');
            const input = activeTab ?
                activeTab.querySelector('#testingPdfUpload') :
                document.getElementById('testingPdfUpload');

            if (!input) {
                console.error('No file input found');
                return;
            }

            // Pick a status span depending on tab
            const statusEl =
                document.getElementById('testingStatusGemini') ||
                document.getElementById('testingStatusGpt51') ||
                document.getElementById('testingStatusGpt5Mini');

            const files = input.files;
            if (!files || files.length === 0) {
                if (statusEl) {
                    statusEl.textContent = 'Select at least one PDF to upload.';
                    statusEl.style.color = '#b91c1c';
                }
                return;
            }

            if (statusEl) {
                statusEl.textContent = `Uploading ${files.length} PDF(s)...`;
                statusEl.style.color = '#64748b';
            }

            let uploaded = 0;
            let failed = 0;
            const failedFiles = [];

            for (const file of files) {
                const formData = new FormData();
                formData.append('file', file);

                try {
                    const resp = await fetch('http://localhost:9000/testing/upload-pdf', {
                        method: 'POST',
                        body: formData,
                    });

                    if (!resp.ok) {
                        const errorData = await resp.json().catch(() => ({}));
                        failedFiles.push(`${file.name}: ${errorData.detail || 'Upload failed'}`);
                        failed += 1;
                        continue;
                    }
                    uploaded += 1;
                } catch (e) {
                    console.error(e);
                    failedFiles.push(`${file.name}: ${e.message}`);
                    failed += 1;
                }
            }

            if (statusEl) {
                let message = `Upload done. Uploaded: ${uploaded}, Failed: ${failed}.`;
                if (failedFiles.length > 0) {
                    message += ` Errors:\n${failedFiles.join('\n')}`;
                }
                statusEl.textContent = message;
                statusEl.style.color = failed === 0 ? '#16a34a' : '#b45309';
            }

            input.value = '';
        }


        // ==================== FILTER FUNCTIONS FOR SEARCH BARS ====================

        // Filter function for Gemini 2.5 Flash table
        function filterGeminiTable() {
            const searchType = document.getElementById('geminiSearchType').value;
            
            // If category type is selected, return (category dropdown handles this)
            if (searchType === 'category') {
                return;
            }
            
            const searchInput = document.getElementById('geminiSearchInput').value.toLowerCase();
            const tbody = document.getElementById('testingComparisonBodyGemini');
            const rows = tbody.getElementsByTagName('tr');
            
            // Clear all filters first
            for (let i = 0; i < rows.length; i++) {
                rows[i].style.display = '';
                delete rows[i].dataset.mismatchHidden;
            }
            
            if (searchInput === '') {
                // If search is empty, show all and apply pagination
                paginationState.gemini.currentPage = 1;
                paginateTable('gemini');
                return;
            }
            
            // Filter by search text from master rows
            let currentGroupShouldShow = false;
            
            for (let i = 0; i < rows.length; i++) {
                const cells = rows[i].getElementsByTagName('td');
                if (cells.length === 0) continue;
                
                const firstCellText = cells[0] ? cells[0].textContent.trim() : '';
                const isMasterRow = firstCellText !== '';
                
                if (isMasterRow) {
                    // Check if master row matches search
                    const cellValue = cells[searchType] ? cells[searchType].textContent.toLowerCase() : '';
                    currentGroupShouldShow = cellValue.includes(searchInput);
                    
                    if (!currentGroupShouldShow) {
                        rows[i].dataset.mismatchHidden = 'true';
                    }
                } else {
                    // Model row follows master row's visibility
                    if (!currentGroupShouldShow) {
                        rows[i].dataset.mismatchHidden = 'true';
                    }
                }
            }
            
            paginationState.gemini.currentPage = 1;
            paginateTable('gemini');
        }


        // Filter function for Overall table
        function filterOverallTable() {
            const searchType = document.getElementById('overallSearchType').value;
            
            if (searchType === 'category') {
                return;
            }
            
            const searchInput = document.getElementById('overallSearchInput').value.toLowerCase();
            const tbody = document.getElementById('testingComparisonBodyOverall');
            const rows = tbody.getElementsByTagName('tr');
            
            for (let i = 0; i < rows.length; i++) {
                rows[i].style.display = '';
                delete rows[i].dataset.mismatchHidden;
            }
            
            if (searchInput === '') {
                paginationState.overall.currentPage = 1;
                paginateTable('overall');
                return;
            }
            
            let currentGroupShouldShow = false;
            
            for (let i = 0; i < rows.length; i++) {
                const cells = rows[i].getElementsByTagName('td');
                if (cells.length === 0) continue;
                
                const firstCellText = cells[0] ? cells[0].textContent.trim() : '';
                const isMasterRow = firstCellText !== '';
                
                if (isMasterRow) {
                    const cellValue = cells[searchType] ? cells[searchType].textContent.toLowerCase() : '';
                    currentGroupShouldShow = cellValue.includes(searchInput);
                    
                    if (!currentGroupShouldShow) {
                        rows[i].dataset.mismatchHidden = 'true';
                    }
                } else {
                    if (!currentGroupShouldShow) {
                        rows[i].dataset.mismatchHidden = 'true';
                    }
                }
            }
            
            paginationState.overall.currentPage = 1;
            paginateTable('overall');
        }


        // Filter function for GPT 5.1 table
        function filterGpt51Table() {
            const searchType = document.getElementById('gpt51SearchType').value;
            
            if (searchType === 'category') {
                return;
            }
            
            const searchInput = document.getElementById('gpt51SearchInput').value.toLowerCase();
            const tbody = document.getElementById('testingComparisonBodyGpt51');
            const rows = tbody.getElementsByTagName('tr');
            
            for (let i = 0; i < rows.length; i++) {
                rows[i].style.display = '';
                delete rows[i].dataset.mismatchHidden;
            }
            
            if (searchInput === '') {
                paginationState.gpt51.currentPage = 1;
                paginateTable('gpt51');
                return;
            }
            
            let currentGroupShouldShow = false;
            
            for (let i = 0; i < rows.length; i++) {
                const cells = rows[i].getElementsByTagName('td');
                if (cells.length === 0) continue;
                
                const firstCellText = cells[0] ? cells[0].textContent.trim() : '';
                const isMasterRow = firstCellText !== '';
                
                if (isMasterRow) {
                    const cellValue = cells[searchType] ? cells[searchType].textContent.toLowerCase() : '';
                    currentGroupShouldShow = cellValue.includes(searchInput);
                    
                    if (!currentGroupShouldShow) {
                        rows[i].dataset.mismatchHidden = 'true';
                    }
                } else {
                    if (!currentGroupShouldShow) {
                        rows[i].dataset.mismatchHidden = 'true';
                    }
                }
            }
            
            paginationState.gpt51.currentPage = 1;
            paginateTable('gpt51');
        }


        // Filter function for GPT 5-mini table
        function filterGpt5MiniTable() {
    const searchType = document.getElementById('gpt5miniSearchType').value;
    if (searchType === 'category') return;

    const searchInput = document.getElementById('gpt5miniSearchInput').value.toLowerCase();
    const tbody = document.getElementById('testingComparisonBodyGpt5Mini');
    const rows = tbody.querySelectorAll('tr');

    let currentGroupShouldShow = false;

    rows.forEach(row => {
        delete row.dataset.mismatchHidden;
    });

    if (searchInput === '') {
        paginationState.gpt5mini.currentPage = 1;
        paginateTable('gpt5mini');
        return;
    }

    rows.forEach(row => {
        const cells = row.querySelectorAll('td');
        if (!cells.length) return;

        // ✅ MASTER ROW = PDF NAME
        const isMasterRow = cells[1].textContent.trim() !== '';

        if (isMasterRow) {
            const cellValue = cells[searchType]
                ? cells[searchType].textContent.toLowerCase()
                : '';
            currentGroupShouldShow = cellValue.includes(searchInput);
            if (!currentGroupShouldShow) {
                row.dataset.mismatchHidden = 'true';
            }
        } else {
            if (!currentGroupShouldShow) {
                row.dataset.mismatchHidden = 'true';
            }
        }
    });

    paginationState.gpt5mini.currentPage = 1;
    paginateTable('gpt5mini');
}

// Toggle mismatch filter - show only rows with errors AND their corresponding master rows
function toggleMismatchFilter(tbodyId, showOnlyMismatches) {
    const tbody = document.getElementById(tbodyId);
    if (!tbody) return;
    
    const rows = tbody.getElementsByTagName('tr');
    
    // Store which rows are hidden by category/search/pagination filters (so we don't unhide them)
    const hiddenByOtherFilters = new Set();
    for (let i = 0; i < rows.length; i++) {
        const r = rows[i];
        if (r.dataset.categoryHidden === 'true' ||
            r.dataset.searchHidden === 'true' ||
            r.dataset.paginationHidden === 'true') {
        hiddenByOtherFilters.add(i);
        }
    }
    
    // Clear display styles per your original logic, and clear pagination flag
    for (let i = 0; i < rows.length; i++) {
        rows[i].style.display = '';
        delete rows[i].dataset.paginationHidden;
    }
    
    if (showOnlyMismatches) {
        // First pass: identify which groups have mismatches
        const rowsToShow = new Set();
        let currentMasterIndex = -1;
    
        for (let i = 0; i < rows.length; i++) {
        // Respect other filters: skip rows already hidden by them
        if (hiddenByOtherFilters.has(i)) continue;
    
        const row = rows[i];
        const cells = row.getElementsByTagName('td');
        if (cells.length === 0) continue;
    
        // Check if this is a master row or model row
        const firstCellText = cells[0] ? (cells[0].textContent || '').trim() : '';
        const isModelRow = firstCellText === ''; // Model rows have empty first cells
    
        if (!isModelRow) {
            // This is a master row
            currentMasterIndex = i;
        } else {
            // This is a model row - check if it has errors
            const hasError = row.classList.contains('highlight-error');
            const hasIncorrectCell = !!row.querySelector('.verified-incorrect');
            const hasMissingCell = !!row.querySelector('.verified-missing');
    
            if (hasError || hasIncorrectCell || hasMissingCell) {
            // Mark both master row and this model row to be shown
            if (currentMasterIndex !== -1) {
                rowsToShow.add(currentMasterIndex); // Add master row
            }
            rowsToShow.add(i); // Add this model row
            }
        }
    }
 
    // Second pass: mark rows to hide by mismatch filter
    for (let i = 0; i < rows.length; i++) {
      if (hiddenByOtherFilters.has(i)) {
        // Keep other filters' hiding
        rows[i].dataset.mismatchHidden = 'true';
      } else if (!rowsToShow.has(i)) {
        // Hide by mismatch filter
        rows[i].dataset.mismatchHidden = 'true';
      } else {
        // Show this row
        delete rows[i].dataset.mismatchHidden;
      }
    }
  } else {
    // Clear mismatch filter but respect other filters
    for (let i = 0; i < rows.length; i++) {
      if (hiddenByOtherFilters.has(i)) {
        rows[i].dataset.mismatchHidden = 'true';
      } else {
        delete rows[i].dataset.mismatchHidden;
      }
    }
  }
 
  // Final pass: actually apply visibility based on flags (mismatch + other filters)
  for (let i = 0; i < rows.length; i++) {
    const r = rows[i];
    const shouldHide =
      r.dataset.mismatchHidden === 'true' ||
           r.dataset.categoryHidden === 'true' ||
      r.dataset.searchHidden === 'true' ||
      r.dataset.paginationHidden === 'true';
 
    r.style.display = shouldHide ? 'none' : '';
  }
            // After filtering, apply pagination
            const tabNameMap = {
                'testingComparisonBodyGemini': 'gemini',
                'testingComparisonBodyGpt51': 'gpt51',
                'testingComparisonBodyGpt5Mini': 'gpt5mini',
                'testingComparisonBodyOverall': 'overall'
            };
            
            const tabName = tabNameMap[tbodyId];
            if (tabName) {
                paginationState[tabName].currentPage = 1;
                paginateTable(tabName);
            }
        }





        document.addEventListener('DOMContentLoaded', () => {
            // Preload all comparisons once so every tab has data ready
            loadGeminiComparison();
            loadGpt51Comparison();
            loadGpt5MiniComparison();
            loadOverallComparison();

            // Add Enter key support for all search inputs
            document.getElementById('geminiSearchInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') filterGeminiTable();
            });

            document.getElementById('overallSearchInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') filterOverallTable();
            });

            document.getElementById('gpt51SearchInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') filterGpt51Table();
            });

            document.getElementById('gpt5miniSearchInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') filterGpt5MiniTable();
            });

        });
    </script>
    <script>
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
        loadAccuracyChart();
        loadCategoryChart();
        loadDisconnectLateChart();
        loadNoticeDateChart();
        loadImpactDateChart();
        loadCorrectRowCounts();   // added impact date chart
    });
} else {
    loadAccuracyChart();
    loadCategoryChart();
    loadDisconnectLateChart();
    loadNoticeDateChart();
    loadImpactDateChart(); 
    loadCorrectRowCounts()      // added impact date chart
}
        // ============================================
        // STANDALONE DOWNLOAD FUNCTIONALITY
        // ============================================

        // Download standalone HTML with all data embedded
        async function downloadStandaloneHTML() {
            try {
                // Show loading message
                const statusMsg = document.createElement('div');
                statusMsg.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #059669; color: white; padding: 12px 20px; border-radius: 6px; z-index: 10000; font-size: 14px;';
                statusMsg.textContent = 'Generating standalone HTML...';
                document.body.appendChild(statusMsg);

                // Capture all table data from DOM
                const geminiTableHTML = document.getElementById('testingComparisonBodyGemini').innerHTML;
                const overallTableHTML = document.getElementById('testingComparisonBodyOverall').innerHTML;
                const gpt51TableHTML = document.getElementById('testingComparisonBodyGpt51').innerHTML;
                const gpt5miniTableHTML = document.getElementById('testingComparisonBodyGpt5Mini').innerHTML;

                // Capture chart data
                const chartData = {
                    accuracy: accuracyChart ? accuracyChart.data : null,
                    category: categoryAccuracyChart ? categoryAccuracyChart.data : null,
                    disconnectLate: disconnectLateChart ? disconnectLateChart.data : null,
                    noticeDate: noticeDateChart ? noticeDateChart.data : null
                };

                // Fetch CSS content
                const cssResponse = await fetch('/static/style.css');
                const cssContent = await cssResponse.text();

                // Create standalone HTML
                const standaloneHTML = generateStandaloneHTML(
                    geminiTableHTML,
                    overallTableHTML,
                    gpt51TableHTML,
                    gpt5miniTableHTML,
                    chartData,
                    cssContent
                );

                // Download the file
                const blob = new Blob([standaloneHTML], {
                    type: 'text/html'
                });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `Vendor_Recognition_Report_${new Date().toISOString().split('T')[0]}.html`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                // Remove loading message
                statusMsg.textContent = 'Download complete!';
                statusMsg.style.background = '#16a34a';
                setTimeout(() => document.body.removeChild(statusMsg), 2000);

            } catch (error) {
                console.error('Error generating standalone HTML:', error);
                alert('Error generating standalone HTML. Please try again.');
            }
        }

        // ========== PAGINATION LOGIC ==========
        const paginationState = {
            gemini: { currentPage: 1, rowsPerPage: 20 },
            gpt51: { currentPage: 1, rowsPerPage: 20 },
            gpt5mini: { currentPage: 1, rowsPerPage: 20 },
            overall: { currentPage: 1, rowsPerPage: 20 }
        };



function paginateTable(tabName) {
    const tbodyIdMap = {
    gemini: 'testingComparisonBodyGemini',
    gpt51: 'testingComparisonBodyGpt51',
    gpt5mini: 'testingComparisonBodyGpt5Mini',
    overall: 'testingComparisonBodyOverall'
};

const tbody = document.getElementById(tbodyIdMap[tabName]);
if (!tbody) return;

    const state = paginationState[tabName];
    const allRows = Array.from(tbody.querySelectorAll('tr'));

    const groups = [];
    let currentGroup = [];

    for (const row of allRows) {
        if (row.dataset.mismatchHidden === 'true') continue;

        const cells = row.querySelectorAll('td');
        if (!cells.length) continue;

        // ✅ MASTER ROW DETECTION (FIXED)
        const isMasterRow = cells[1].textContent.trim() !== '';

        if (isMasterRow && currentGroup.length) {
            groups.push(currentGroup);
            currentGroup = [row];
        } else {
            currentGroup.push(row);
        }
    }
    if (currentGroup.length) groups.push(currentGroup);

    const totalGroups = groups.length;
    const totalPages = Math.max(1, Math.ceil(totalGroups / state.rowsPerPage));

    const startIndex = (state.currentPage - 1) * state.rowsPerPage;
    const endIndex = startIndex + state.rowsPerPage;

    allRows.forEach(r => r.style.display = 'none');

    groups.forEach((group, idx) => {
        if (idx >= startIndex && idx < endIndex) {
            group.forEach(r => r.style.display = '');
        }
    });

    updatePaginationInfo(tabName, state.currentPage, totalPages, totalGroups);
}

        function updatePaginationInfo(tabName, currentPage, totalPages, totalGroups) {
    const pageInfoTop = document.getElementById(`${tabName}PageInfo`);
    const pageInfoBottom = document.getElementById(`${tabName}PageInfoBottom`);

    const rowsPerPage = paginationState[tabName].rowsPerPage;

    const startRow = totalGroups === 0
        ? 0
        : (currentPage - 1) * rowsPerPage + 1;

    const endRow = Math.min(currentPage * rowsPerPage, totalGroups);

    const infoText = `Page ${currentPage} of ${totalPages} (Displaying ${startRow}-${endRow} rows of ${totalGroups} Total)`;

    if (pageInfoTop) pageInfoTop.textContent = infoText;
    if (pageInfoBottom) pageInfoBottom.textContent = infoText;
}

        function changePage(tabName, direction) {
    const state = paginationState[tabName];
    const tbodyIdMap = {
    gemini: 'testingComparisonBodyGemini',
    gpt51: 'testingComparisonBodyGpt51',
    gpt5mini: 'testingComparisonBodyGpt5Mini',
    overall: 'testingComparisonBodyOverall'
};

const tbody = document.getElementById(tbodyIdMap[tabName]);
if (!tbody) return;

    const rows = Array.from(tbody.querySelectorAll('tr'))
        .filter(r => r.dataset.mismatchHidden !== 'true');

    const groups = [];
    let currentGroup = [];

    for (const row of rows) {
        const cells = row.querySelectorAll('td');
        if (!cells.length) continue;

        // ✅ SAME MASTER ROW LOGIC
        const isMasterRow = cells[1].textContent.trim() !== '';

        if (isMasterRow && currentGroup.length) {
            groups.push(currentGroup);
            currentGroup = [row];
        } else {
            currentGroup.push(row);
        }
    }
    if (currentGroup.length) groups.push(currentGroup);

    const totalPages = Math.max(1, Math.ceil(groups.length / state.rowsPerPage));
    const newPage = state.currentPage + direction;

    if (newPage < 1 || newPage > totalPages) return;

    state.currentPage = newPage;
    paginateTable(tabName);
}

        // Update existing load functions to reset pagination
        const originalLoadGeminiComparison = loadGeminiComparison;
        loadGeminiComparison = async function() {
            await originalLoadGeminiComparison();
            populateCategoryDropdown('testingComparisonBodyGemini', 'geminiCategorySelect');
            paginationState.gemini.currentPage = 1;
            paginateTable('gemini');
        };

        const originalLoadGpt51Comparison = loadGpt51Comparison;
        loadGpt51Comparison = async function() {
            await originalLoadGpt51Comparison();
            populateCategoryDropdown('testingComparisonBodyGpt51', 'gpt51CategorySelect');
            paginationState.gpt51.currentPage = 1;
            paginateTable('gpt51');
        };

        const originalLoadGpt5MiniComparison = loadGpt5MiniComparison;
        loadGpt5MiniComparison = async function () {
            await originalLoadGpt5MiniComparison();
            populateCategoryDropdown('testingComparisonBodyGpt5Mini', 'gpt5miniCategorySelect');
            paginationState.gpt5mini.currentPage = 1;
            paginateTable('gpt5mini');
        };


        const originalLoadOverallComparison = loadOverallComparison;
        loadOverallComparison = async function() {
            await originalLoadOverallComparison();
            populateCategoryDropdown('testingComparisonBodyOverall', 'overallCategorySelect');
            paginationState.overall.currentPage = 1;
            paginateTable('overall');
        };

        // ========== NOTICE TYPE FILTER LOGIC ==========

        // Function to populate category dropdowns with unique categories from master rows
        function populateCategoryDropdown(tbodyId, selectId) {
            const tbody = document.getElementById(tbodyId);
            const select = document.getElementById(selectId);
            
            if (!tbody || !select) return;
            
            const categories = new Set();
            const rows = tbody.getElementsByTagName('tr');
            
            // Loop through all rows and extract categories from master rows
            for (let i = 0; i < rows.length; i++) {
                const cells = rows[i].getElementsByTagName('td');
                if (cells.length === 0) continue;
                
                const firstCellText = cells[0] ? cells[0].textContent.trim() : '';
                const isMasterRow = firstCellText !== ''; // Master rows have S.No
                
                if (isMasterRow && cells[7]) { // Column 7 is Category (0-indexed: S.No, PDF, Model, VA, VN, SA, VI, Category)
                    const category = cells[7].textContent.trim();
                    if (category && category !== '-') {
                        categories.add(category);
                    }
                }
            }
            
            document.addEventListener('DOMContentLoaded', function () {
    const searchType = document.getElementById('geminiSearchType');
    const categorySelect = document.getElementById('geminiCategorySelect');

    // Show category dropdown if "Notice Type" is selected
    if (searchType.value === 'category') {
        categorySelect.style.display = 'inline-block';
        populateCategoryDropdown('testingComparisonBodyGemini', 'geminiCategorySelect');
    }

    // Optional: if you have a change listener, trigger it
    searchType.dispatchEvent(new Event('change'));
});

            // Clear existing options except the first one
            select.innerHTML = '<option value=""> All </option>';
            
            // Add sorted categories to dropdown
            const sortedCategories = Array.from(categories).sort();
            sortedCategories.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat;
                option.textContent = cat;
                select.appendChild(option);
            });
        }

        // Function to show/hide category dropdown based on search type selection
        function handleSearchTypeChange(searchTypeId, searchInputId, categorySelectId) {
            const searchType = document.getElementById(searchTypeId).value;
            const searchInput = document.getElementById(searchInputId);
            const categorySelect = document.getElementById(categorySelectId);
            
            if (searchType === 'category') {
                // Hide text input, show category dropdown
                searchInput.style.display = 'none';
                categorySelect.style.display = '';
            } else {
                // Show text input, hide category dropdown
                searchInput.style.display = '';
                categorySelect.style.display = 'none';
            }
        }

      
// Add event listeners for search type changes
document.addEventListener('DOMContentLoaded', function() {
    // Gemini
    const geminiSearchType = document.getElementById('geminiSearchType');
    const geminiCategorySelect = document.getElementById('geminiCategorySelect');

    geminiSearchType.addEventListener('change', function() {
        handleSearchTypeChange('geminiSearchType', 'geminiSearchInput', 'geminiCategorySelect');
    });
    geminiCategorySelect.addEventListener('change', function() {
        filterGeminiTableByCategory();
    });

    // GPT 5.1
    const gpt51SearchType = document.getElementById('gpt51SearchType');
    const gpt51CategorySelect = document.getElementById('gpt51CategorySelect');

    gpt51SearchType.addEventListener('change', function() {
        handleSearchTypeChange('gpt51SearchType', 'gpt51SearchInput', 'gpt51CategorySelect');
    });
    gpt51CategorySelect.addEventListener('change', function() {
        filterGpt51TableByCategory();
    });

    // GPT 5-mini
    const gpt5miniSearchType = document.getElementById('gpt5miniSearchType');
    const gpt5miniCategorySelect = document.getElementById('gpt5miniCategorySelect');

    gpt5miniSearchType.addEventListener('change', function() {
        handleSearchTypeChange('gpt5miniSearchType', 'gpt5miniSearchInput', 'gpt5miniCategorySelect');
    });
    gpt5miniCategorySelect.addEventListener('change', function() {
        filterGpt5MiniTableByCategory();
    });

    // Overall
    const overallSearchType = document.getElementById('overallSearchType');
    const overallCategorySelect = document.getElementById('overallCategorySelect');

    overallSearchType.addEventListener('change', function() {
        handleSearchTypeChange('overallSearchType', 'overallSearchInput', 'overallCategorySelect');
    });
    overallCategorySelect.addEventListener('change', function() {
        filterOverallTableByCategory();
    });

    // ====== NEW: trigger default Notice Type logic on load ======
    // Gemini
    if (geminiSearchType.value === 'category') {
        handleSearchTypeChange('geminiSearchType', 'geminiSearchInput', 'geminiCategorySelect');
    }
    // GPT 5.1
    if (gpt51SearchType.value === 'category') {
        handleSearchTypeChange('gpt51SearchType', 'gpt51SearchInput', 'gpt51CategorySelect');
    }
    // GPT 5-mini
    if (gpt5miniSearchType.value === 'category') {
        handleSearchTypeChange('gpt5miniSearchType', 'gpt5miniSearchInput', 'gpt5miniCategorySelect');
    }
    // Overall
    if (overallSearchType.value === 'category') {
        handleSearchTypeChange('overallSearchType', 'overallSearchInput', 'overallCategorySelect');
    }
});
        // Category filter functions for each tab
        function filterGeminiTableByCategory() {
            const selectedCategory = document.getElementById('geminiCategorySelect').value;
            const tbody = document.getElementById('testingComparisonBodyGemini');
            const rows = tbody.getElementsByTagName('tr');
            
            // Clear all filters first
            for (let i = 0; i < rows.length; i++) {
                rows[i].style.display = '';
                delete rows[i].dataset.mismatchHidden;
            }
            
            if (selectedCategory === '') {
                // If no category selected, show all
                paginationState.gemini.currentPage = 1;
                paginateTable('gemini');
                return;
            }
            
            // Filter by category from master rows
            let currentMasterCategory = '';
            let currentGroupShouldShow = false;
            
            for (let i = 0; i < rows.length; i++) {
                const cells = rows[i].getElementsByTagName('td');
                if (cells.length === 0) continue;
                
                const firstCellText = cells[0] ? cells[0].textContent.trim() : '';
                const isMasterRow = firstCellText !== '';
                
                if (isMasterRow) {
                    // This is a master row
                    const category = cells[7] ? cells[7].textContent.trim() : '';
                    currentMasterCategory = category;
                    currentGroupShouldShow = (category === selectedCategory);
                    
                    if (!currentGroupShouldShow) {
                        rows[i].dataset.mismatchHidden = 'true';
                    }
                } else {
                    // This is a model row - follow master row's visibility
                    if (!currentGroupShouldShow) {
                        rows[i].dataset.mismatchHidden = 'true';
                    }
                }
            }
            
            paginationState.gemini.currentPage = 1;
            paginateTable('gemini');
        }

        function filterGpt51TableByCategory() {
            const selectedCategory = document.getElementById('gpt51CategorySelect').value;
            const tbody = document.getElementById('testingComparisonBodyGpt51');
            const rows = tbody.getElementsByTagName('tr');
            
            for (let i = 0; i < rows.length; i++) {
                rows[i].style.display = '';
                delete rows[i].dataset.mismatchHidden;
            }
            
            if (selectedCategory === '') {
                paginationState.gpt51.currentPage = 1;
                paginateTable('gpt51');
                return;
            }
            
            let currentGroupShouldShow = false;
            
            for (let i = 0; i < rows.length; i++) {
                const cells = rows[i].getElementsByTagName('td');
                if (cells.length === 0) continue;
                
                const firstCellText = cells[0] ? cells[0].textContent.trim() : '';
                const isMasterRow = firstCellText !== '';
                
                if (isMasterRow) {
                    const category = cells[7] ? cells[7].textContent.trim() : '';
                    currentGroupShouldShow = (category === selectedCategory);
                    
                    if (!currentGroupShouldShow) {
                        rows[i].dataset.mismatchHidden = 'true';
                    }
                } else {
                    if (!currentGroupShouldShow) {
                        rows[i].dataset.mismatchHidden = 'true';
                    }
                }
            }
            
            paginationState.gpt51.currentPage = 1;
            paginateTable('gpt51');
        }

        function filterGpt5MiniTableByCategory() {
    const selectedCategory = document.getElementById('gpt5miniCategorySelect').value;
    const tbody = document.getElementById('testingComparisonBodyGpt5Mini');
    const rows = tbody.querySelectorAll('tr');

    let currentGroupShouldShow = false;

    rows.forEach(row => {
        delete row.dataset.mismatchHidden;
    });

    if (!selectedCategory) {
        paginationState.gpt5mini.currentPage = 1;
        paginateTable('gpt5mini');
        return;
    }

    rows.forEach(row => {
        const cells = row.querySelectorAll('td');
        if (!cells.length) return;

        const isMasterRow = cells[1].textContent.trim() !== '';

        if (isMasterRow) {
            const category = cells[7]?.textContent.trim();
            currentGroupShouldShow = category === selectedCategory;
            if (!currentGroupShouldShow) {
                row.dataset.mismatchHidden = 'true';
            }
        } else {
            if (!currentGroupShouldShow) {
                row.dataset.mismatchHidden = 'true';
            }
        }
    });

    paginationState.gpt5mini.currentPage = 1;
    paginateTable('gpt5mini');
}

        function filterOverallTableByCategory() {
            const selectedCategory = document.getElementById('overallCategorySelect').value;
            const tbody = document.getElementById('testingComparisonBodyOverall');
            const rows = tbody.getElementsByTagName('tr');
            
            for (let i = 0; i < rows.length; i++) {
                rows[i].style.display = '';
                delete rows[i].dataset.mismatchHidden;
            }
            
            if (selectedCategory === '') {
                paginationState.overall.currentPage = 1;
                paginateTable('overall');
                return;
            }
            
            let currentGroupShouldShow = false;
            
            for (let i = 0; i < rows.length; i++) {
                const cells = rows[i].getElementsByTagName('td');
                if (cells.length === 0) continue;
                
                const firstCellText = cells[0] ? cells[0].textContent.trim() : '';
                const isMasterRow = firstCellText !== '';
                
                if (isMasterRow) {
                    const category = cells[7] ? cells[7].textContent.trim() : '';
                    currentGroupShouldShow = (category === selectedCategory);
                    
                    if (!currentGroupShouldShow) {
                        rows[i].dataset.mismatchHidden = 'true';
                    }
                } else {
                    if (!currentGroupShouldShow) {
                        rows[i].dataset.mismatchHidden = 'true';
                    }
                }
            }
            
            paginationState.overall.currentPage = 1;
            paginateTable('overall');
        }



        function generateStandaloneHTML(geminiHTML, overallHTML, gpt51HTML, gpt5miniHTML, chartData, cssContent) {
            return `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AI Model Comparison for Vendor Recognition - Standalone Report</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"><\/script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"><\/script>
    <style>
        ${cssContent}
        .offline-banner {
            background: #fef3c7;
            color: #92400e;
            padding: 10px;
            text-align: center;
            font-size: 14px;
            border-bottom: 2px solid #fbbf24;
        }
    </style>
</head>
<body>
    <div class="offline-banner">
        📦 Standalone Report - Generated on ${new Date().toLocaleString()}
    </div>
    <div class="container">
        <header>
            <h1>AI Model Comparison for Vendor Notices</h1>
        </header>
        <div class="top-actions">
            <button class="download-pdf-btn" onclick="window.print()">
                Download as PDF
            </button>
        </div>
        <nav class="tab-bar">
            <button class="tab active" data-tab="dashboard">Dashboard</button>
            <button class="tab" data-tab="gemini">Gemini 2.5 Flash</button>
            <button class="tab" data-tab="gpt51">GPT 5.1</button>
            <button class="tab" data-tab="gpt5mini">GPT 5-mini</button>
            <button class="tab" data-tab="overall">Overall</button>
        </nav>

        <section id="dashboard" class="tab-content active">
            <h2>Accuracy Comparison For Vendor Recognition</h2>
            <canvas id="accuracyChart"></canvas>

            <h3 class="detailed-heading">Category-wise Classification Accuracy by Model</h3>
            <div style="width: 100%; height: 455px; padding: 20px; background: #ffffff; border-radius: 12px; box-shadow: 0 1px 6px rgba(0,0,0,0.05);">
                <h4 style="margin: 0 0 12px 0; font-size: 0.95rem; color: #2a4d69;">Notice Category Classification Accuracy (%)</h4>
                <p style="margin: 0 0 12px 0; font-size: 0.85rem; color: #64748b;">Shows how accurately each model classifies notices into their correct category</p>
                <div style="position: relative; width: 100%; height: 355px;">
                    <canvas id="categoryAccuracyChart"></canvas>
                </div>
            </div>

// <h3 class="detailed-heading">Category-wise Classification Accuracy by Model</h3>
// <div style="width: 100%; height: 455px; padding: 20px; background: #ffffff; border-radius: 12px; box-shadow: 0 1px 6px rgba(0,0,0,0.05);">
//     <h4 style="margin: 0 0 12px 0; font-size: 0.95rem; color: #2a4d69;">Notice Category Classification Accuracy (%)</h4>
//     <p style="margin: 0 0 12px 0; font-size: 0.85rem; color: #64748b;">Shows how accurately each model classifies notices into their correct category</p>
//     <div style="position: relative; width: 100%; height: 350px;">
//         <canvas id="categoryAccuracyChart"></canvas>
//     </div>
// </div>

// <h3 class="detailed-heading">Category-wise Classification Accuracy by Model</h3>
// <div style="width: 100%; height: 460px; padding: 20px; background: #ffffff; border-radius: 12px; box-shadow: 0 1px 6px rgba(0,0,0,0.05);">
//   <h4 style="margin: 0 0 12px 0; font-size: 0.95rem; color: #2a4d69;">
//     Notice Category Classification Accuracy (%)
//   </h4>
//   <p style="margin: 0 0 12px 0; font-size: 0.85rem; color: #64748b;">
//     Shows how accurately each model classifies notices into their correct category
//   </p>
//   <div style="position: relative; width: 100%; height: 360px;">
//     <canvas id="categoryAccuracyChart"></canvas>
//   </div>
// </div>

            <h3 class="detailed-heading">Impact Date and Impact Amount Recognition Accuracy for Disconnect and Late Notice</h3>
            <div class="chart-grid">
                <div class="chart-card" style="width: 420px; min-height: 260px;">
                    <canvas id="disconnectLateChart" style="width: 100%; height: 220px;"></canvas>
                </div>
            </div>

            <h3 class="detailed-heading">Notice Date Recognition Accuracy for All Notice Types</h3>
            <div class="chart-grid">
                <div class="chart-card" style="width: 420px; min-height: 260px;">
                    <canvas id="noticeDateChart" style="width: 100%; height: 220px;"></canvas>
                </div>
            </div>
        </section>

        <section id="gemini" class="tab-content">
            <h2>Gemini 2.5 Flash Comparison Report</h2>
            
            <div style="margin-top: 10px; margin-bottom: 15px; display: flex; gap: 8px; align-items: center;">
                <select id="geminiSearchType" style="padding: 6px; border: 1px solid #ccc; border-radius: 4px; outline: none;">
                    <option value="3">Vendor Account</option>
                    <option value="4">Vendor Name</option>
                    <option value="5">Service Address</option>
                </select>
                
                <input type="text" id="geminiSearchInput" placeholder="Search Gemini Results" 
                    style="padding: 6px; border: 1px solid #ccc; border-radius: 4px; outline: none;">
                
                <div onclick="filterGeminiTable()" style="cursor: pointer; padding: 4px; display: flex; align-items: center;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#333" viewBox="0 0 16 16">
                        <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                    </svg>
                </div>
            </div>

            <div style="margin-bottom: 10px; display: flex; align-items: center; gap: 6px;">
                <input type="checkbox" id="geminiShowMismatchOnly" onchange="toggleMismatchFilter('testingComparisonBodyGemini', this.checked)" style="cursor: pointer;">
                <label for="geminiShowMismatchOnly" style="cursor: pointer; font-size: 0.9rem; color: #1e293b;">Show only mismatched rows</label>
            </div>

            <div class="table-container">
                <table class="report-table">
                    <thead>
                        <tr>
                            <th rowspan="2">S.No</th>
                            <th rowspan="2">PDF Name</th>
                            <th rowspan="2">Model</th>
                            <th colspan="3">Vendor Recognition</th>
                            <th rowspan="2">Vendor Identification</th>
                            <th rowspan="2">Category</th>
                            <th rowspan="2">Notice Date</th>
                            <th rowspan="2">Impact Date</th>
                            <th rowspan="2">Impact Amount</th>
                        </tr>
                        <tr>
                            <th>Vendor Account</th>
                            <th>Vendor Name</th>
                            <th>Service Address</th>
                        </tr>
                    </thead>
                    <tbody id="testingComparisonBodyGemini">
                        ${geminiHTML}
                    </tbody>
                </table>
            </div>
        </section>

        <section id="overall" class="tab-content">
            <h2>Overall Test Report</h2>
            
            <div style="margin-top: 10px; margin-bottom: 15px; display: flex; gap: 8px; align-items: center;">
                <select id="overallSearchType" style="padding: 6px; border: 1px solid #ccc; border-radius: 4px; outline: none;">
                    <option value="3">Vendor Account</option>
                    <option value="4">Vendor Name</option>
                    <option value="5">Service Address</option>
                </select>
                
                <input type="text" id="overallSearchInput" placeholder="Search Overall Results" 
                    style="padding: 6px; border: 1px solid #ccc; border-radius: 4px; outline: none;">
                
                <div onclick="filterOverallTable()" style="cursor: pointer; padding: 4px; display: flex; align-items: center;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#333" viewBox="0 0 16 16">
                        <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                    </svg>
                </div>
            </div>

            <div style="margin-bottom: 10px; display: flex; align-items: center; gap: 6px;">
                <input type="checkbox" id="overallShowMismatchOnly" onchange="toggleMismatchFilter('testingComparisonBodyOverall', this.checked)" style="cursor: pointer;">
                <label for="overallShowMismatchOnly" style="cursor: pointer; font-size: 0.9rem; color: #1e293b;">Show only mismatched rows</label>
            </div>

            <div class="table-container">
                <table class="report-table">
                    <thead>
                        <tr>
                            <th rowspan="2">S.No</th>
                            <th rowspan="2">PDF Name</th>
                            <th rowspan="2">Model</th>
                            <th colspan="3">Vendor Identification</th>
                            <th rowspan="2">Vendor Details Verified</th>
                            <th rowspan="2">Category</th>
                            <th rowspan="2">Notice Date</th>
                            <th rowspan="2">Impact Date</th>
                            <th rowspan="2">Impact Amount</th>
                        </tr>
                        <tr>
                            <th>Vendor Account</th>
                            <th>Vendor Name</th>
                            <th>Service Address</th>
                        </tr>
                    </thead>
                    <tbody id="testingComparisonBodyOverall">
                        ${overallHTML}
                    </tbody>
                </table>
            </div>
        </section>

        <section id="gpt51" class="tab-content">
            <h2>GPT 5.1 Comparison Report</h2>
            
            <div style="margin-top: 10px; margin-bottom: 15px; display: flex; gap: 8px; align-items: center;">
                <select id="gpt51SearchType" style="padding: 6px; border: 1px solid #ccc; border-radius: 4px; outline: none;">
                    <option value="3">Vendor Account</option>
                    <option value="4">Vendor Name</option>
                    <option value="5">Service Address</option>
                </select>
                
                <input type="text" id="gpt51SearchInput" placeholder="Search GPT 5.1 Results" 
                    style="padding: 6px; border: 1px solid #ccc; border-radius: 4px; outline: none;">
                
                <div onclick="filterGpt51Table()" style="cursor: pointer; padding: 4px; display: flex; align-items: center;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#333" viewBox="0 0 16 16">
                        <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                    </svg>
                </div>
            </div>

            <div style="margin-bottom: 10px; display: flex; align-items: center; gap: 6px;">
                <input type="checkbox" id="gpt51ShowMismatchOnly" onchange="toggleMismatchFilter('testingComparisonBodyGpt51', this.checked)" style="cursor: pointer;">
                <label for="gpt51ShowMismatchOnly" style="cursor: pointer; font-size: 0.9rem; color: #1e293b;">Show only mismatched rows</label>
            </div>

            <div class="table-container">
                <table class="report-table">
                    <thead>
                        <tr>
                            <th rowspan="2">S.No</th>
                            <th rowspan="2">PDF Name</th>
                            <th rowspan="2">Model</th>
                            <th colspan="3">Vendor Identification</th>
                            <th rowspan="2">Vendor Details Verified</th>
                            <th rowspan="2">Category</th>
                            <th rowspan="2">Notice Date</th>
                            <th rowspan="2">Impact Date</th>
                            <th rowspan="2">Impact Amount</th>
                        </tr>
                        <tr>
                            <th>Vendor Account</th>
                            <th>Vendor Name</th>
                            <th>Service Address</th>
                        </tr>
                    </thead>
                    <tbody id="testingComparisonBodyGpt51">
                        ${gpt51HTML}
                    </tbody>
                </table>
            </div>
        </section>

        <section id="gpt5mini" class="tab-content">
            <h2>GPT 5-mini Comparison Report</h2>
            
            <div style="margin-top: 10px; margin-bottom: 15px; display: flex; gap: 8px; align-items: center;">
                <select id="gpt5miniSearchType" style="padding: 6px; border: 1px solid #ccc; border-radius: 4px; outline: none;">
                    <option value="3">Vendor Account</option>
                    <option value="4">Vendor Name</option>
                    <option value="5">Service Address</option>
                </select>
                
                <input type="text" id="gpt5miniSearchInput" placeholder="Search GPT 5-mini Results" 
                    style="padding: 6px; border: 1px solid #ccc; border-radius: 4px; outline: none;">
                
                <div onclick="filterGpt5MiniTable()" style="cursor: pointer; padding: 4px; display: flex; align-items: center;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#333" viewBox="0 0 16 16">
                        <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                    </svg>
                </div>
            </div>

            <div style="margin-bottom: 10px; display: flex; align-items: center; gap: 6px;">
                <input type="checkbox" id="gpt5miniShowMismatchOnly" onchange="toggleMismatchFilter('testingComparisonBodyGpt5Mini', this.checked)" style="cursor: pointer;">
                <label for="gpt5miniShowMismatchOnly" style="cursor: pointer; font-size: 0.9rem; color: #1e293b;">Show only mismatched rows</label>
            </div>

            <div class="table-container">
                <table class="report-table">
                    <thead>
                        <tr>
                            <th rowspan="2">S.No</th>
                            <th rowspan="2">PDF Name</th>
                            <th rowspan="2">Model</th>
                            <th colspan="3">Vendor Identification</th>
                            <th rowspan="2">Vendor Details Verified</th>
                            <th rowspan="2">Category</th>
                            <th rowspan="2">Notice Date</th>
                            <th rowspan="2">Impact Date</th>
                            <th rowspan="2">Impact Amount</th>
                        </tr>
                        <tr>
                            <th>Vendor Account</th>
                            <th>Vendor Name</th>
                            <th>Service Address</th>
                        </tr>
                    </thead>
                    <tbody id="testingComparisonBodyGpt5Mini">
                        ${gpt5miniHTML}
                    </tbody>
                </table>
            </div>
        </section>
    </div>

    <script>
        // Embedded chart data
        const embeddedChartData = ${JSON.stringify(chartData)};

        // Tab switching
        const tabs = document.querySelectorAll('.tab');
        const contents = document.querySelectorAll('.tab-content');
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                tabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                contents.forEach(c => c.classList.remove('active'));
                document.getElementById(tab.dataset.tab).classList.add('active');
            });
        });

        // Register datalabels plugin
        Chart.register(ChartDataLabels);

        // Create charts with embedded data
        let accuracyChart, categoryAccuracyChart, disconnectLateChart, noticeDateChart;

        if (embeddedChartData.accuracy) {
            const ctx = document.getElementById('accuracyChart').getContext('2d');
            accuracyChart = new Chart(ctx, {
                type: 'bar',
                data: embeddedChartData.accuracy,
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false },
                        title: { display: false },
                        datalabels: {
                            anchor: 'end',
                            align: 'end',
                            offset: 4,
                            formatter: (value) => value + '%',
                            font: { weight: 'bold', size: 11 },
                            color: '#2a4d69'
                        }
                    },
                    scales: {
                        y: { beginAtZero: true, max: 100 }
                    }
                }
            });
        }

        if (embeddedChartData.category) {
            const categoryCtx = document.getElementById('categoryAccuracyChart').getContext('2d');
            categoryAccuracyChart = new Chart(categoryCtx, {
                type: 'bar',
                data: embeddedChartData.category,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    layout: {                    // ADD THIS HERE TOO
                        padding: {
                            top: 25,
                            bottom: 0,
                            left: 0,
                            right: 0
                        }
                    },
                    plugins: {
                        legend: { 
                            position: 'bottom',
                            labels: {
                                font: { size: 12 },
                                padding: 15
                            }
                        },
                        datalabels: {
                            anchor: 'end',
                            align: 'end',
                            offset: 4,
                            formatter: (value) => {
                                if (value === null || value === undefined || value === 0) return '';
                                return value.toFixed(1) + "%";
                            },
                            font: { weight: 'bold', size: 10 },
                            color: '#2a4d69'
                        },
                        tooltip: {
                            callbacks: {
                                label: (ctx) => {
                                    const value = ctx.parsed.y;
                                    if (value === null || value === undefined) return ctx.dataset.label + ': N/A';
                                    return ctx.dataset.label + ': ' + value.toFixed(1) + '% accuracy';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { 
                                maxRotation: 0, 
                                minRotation: 0,
                                font: { size: 11 }
                            },
                            title: {
                                display: true,
                                text: 'Notice Category',
                                font: { size: 12, weight: 'bold' },
                                padding: { top: 10 }
                            }
                        },
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            },
                            title: {
                                display: true,
                                text: 'Classification Accuracy (%)',
                                font: { size: 12, weight: 'bold' },
                                padding: { bottom: 10 }
                            }
                        }
                    }
                }
            });
        }

        if (embeddedChartData.disconnectLate) {
            const disconnectCtx = document.getElementById('disconnectLateChart').getContext('2d');
            disconnectLateChart = new Chart(disconnectCtx, {
                type: 'bar',
                data: embeddedChartData.disconnectLate,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        datalabels: {
                            anchor: 'end',
                            align: 'end',
                            offset: 4,
                            formatter: (value) => value + '%',
                            font: { weight: 'bold', size: 11 },
                            color: '#2a4d69'
                        }
                    },
                    scales: {
                        y: { beginAtZero: true, max: 100 }
                    }
                }
            });
        }

        if (embeddedChartData.noticeDate) {
            const noticeDateCtx = document.getElementById('noticeDateChart').getContext('2d');
            noticeDateChart = new Chart(noticeDateCtx, {
                type: 'bar',
                data: embeddedChartData.noticeDate,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        datalabels: {
                            anchor: 'end',
                            align: 'end',
                            offset: 4,
                            formatter: (value) => value + '%',
                            font: { weight: 'bold', size: 11 },
                            color: '#2a4d69'
                        }
                    },
                    scales: {
                        y: { beginAtZero: true, max: 100 }
                    }
                }
            });
        }

        // Filter functions
        function filterGeminiTable() {
            const searchType = document.getElementById('geminiSearchType').value;
            const searchInput = document.getElementById('geminiSearchInput').value.toLowerCase();
            const tbody = document.getElementById('testingComparisonBodyGemini');
            const rows = tbody.getElementsByTagName('tr');
            
            for (let i = 0; i < rows.length; i++) {
                const cells = rows[i].getElementsByTagName('td');
                if (cells.length > 0) {
                    const cellValue = cells[searchType] ? cells[searchType].textContent.toLowerCase() : '';
                    if (cellValue.includes(searchInput) || searchInput === '') {
                        rows[i].style.display = '';
                    } else {
                        rows[i].style.display = 'none';
                    }
                }
            }
        }

        function filterOverallTable() {
            const searchType = document.getElementById('overallSearchType').value;
            const searchInput = document.getElementById('overallSearchInput').value.toLowerCase();
            const tbody = document.getElementById('testingComparisonBodyOverall');
            const rows = tbody.getElementsByTagName('tr');
            
            for (let i = 0; i < rows.length; i++) {
                const cells = rows[i].getElementsByTagName('td');
                if (cells.length > 0) {
                    const cellValue = cells[searchType] ? cells[searchType].textContent.toLowerCase() : '';
                    if (cellValue.includes(searchInput) || searchInput === '') {
                        rows[i].style.display = '';
                    } else {
                        rows[i].style.display = 'none';
                    }
                }
            }
        }

        function filterGpt51Table() {
            const searchType = document.getElementById('gpt51SearchType').value;
            const searchInput = document.getElementById('gpt51SearchInput').value.toLowerCase();
            const tbody = document.getElementById('testingComparisonBodyGpt51');
            const rows = tbody.getElementsByTagName('tr');
            
            for (let i = 0; i < rows.length; i++) {
                const cells = rows[i].getElementsByTagName('td');
                if (cells.length > 0) {
                    const cellValue = cells[searchType] ? cells[searchType].textContent.toLowerCase() : '';
                    if (cellValue.includes(searchInput) || searchInput === '') {
                        rows[i].style.display = '';
                    } else {
                        rows[i].style.display = 'none';
                    }
                }
            }
        }

        function filterGpt5MiniTable() {
            const searchType = document.getElementById('gpt5miniSearchType').value;
            const searchInput = document.getElementById('gpt5miniSearchInput').value.toLowerCase();
            const tbody = document.getElementById('testingComparisonBodyGpt5Mini');
            const rows = tbody.getElementsByTagName('tr');
            
            for (let i = 0; i < rows.length; i++) {
                const cells = rows[i].getElementsByTagName('td');
                if (cells.length > 0) {
                    const cellValue = cells[searchType] ? cells[searchType].textContent.toLowerCase() : '';
                    if (cellValue.includes(searchInput) || searchInput === '') {
                        rows[i].style.display = '';
                    } else {
                        rows[i].style.display = 'none';
                    }
                }
            }
        }

        function toggleMismatchFilter(tbodyId, showOnlyMismatches) {
            const tbody = document.getElementById(tbodyId);
            if (!tbody) return;
            
            const rows = tbody.getElementsByTagName('tr');
            
            if (showOnlyMismatches) {
                const rowsToShow = new Set();
                let currentMasterIndex = -1;
                
                for (let i = 0; i < rows.length; i++) {
                    const row = rows[i];
                    const cells = row.getElementsByTagName('td');
                    
                    if (cells.length === 0) continue;
                    
                    const firstCellText = cells[0] ? cells[0].textContent.trim() : '';
                    const isModelRow = firstCellText === '';
                    
                    if (!isModelRow) {
                        currentMasterIndex = i;
                    } else {
                        const hasError = row.classList.contains('highlight-error');
                        const hasIncorrectCell = row.querySelector('.verified-incorrect');
                        const hasMissingCell = row.querySelector('.verified-missing');
                        
                        if (hasError || hasIncorrectCell || hasMissingCell) {
                            if (currentMasterIndex !== -1) {
                                rowsToShow.add(currentMasterIndex);
                            }
                            rowsToShow.add(i);
                        }
                    }
                }
                
                for (let i = 0; i < rows.length; i++) {
                    if (rowsToShow.has(i)) {
                        rows[i].style.display = '';
                    } else {
                        rows[i].style.display = 'none';
                    }
                }
            } else {
                for (let i = 0; i < rows.length; i++) {
                    rows[i].style.display = '';
                }
            }
        }

        // Add Enter key support
        document.getElementById('geminiSearchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') filterGeminiTable();
        });
        
        document.getElementById('overallSearchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') filterOverallTable();
        });
        
        document.getElementById('gpt51SearchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') filterGpt51Table();
        });
        
        document.getElementById('gpt5miniSearchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') filterGpt5MiniTable();
        });
    <\/script>
</body>
</html>`;
        }
    </script>
   
<script>
async function loadCorrectRowCounts() {
    try {
        const resp = await fetch('http://localhost:9000/testing/analytics/correct-row-counts');
        const data = await resp.json();

        function setSummary(elId, correct, total) {
            const percent = total === 0 ? 0 : ((correct / total) * 100).toFixed(2);
            const el = document.getElementById(elId);

            el.textContent = `Match Rate: ${correct}/${total} (${percent}%)`;

            if (percent > 80) {
                el.style.color = 'green';
            } else if (percent >= 60) {
                el.style.color = 'orange'; // yellow but readable
            } else {
                el.style.color = 'red';
            }
        }

        setSummary('geminiFullCorrectSummary', data.gemini.correct, data.gemini.total);
        setSummary('gpt51FullCorrectSummary', data.gpt_5_1.correct, data.gpt_5_1.total);
        setSummary('gpt5miniFullCorrectSummary', data.gpt_5_mini.correct, data.gpt_5_mini.total);

    } catch (e) {
        console.error('Error loading perfect row counts', e);
    }
}

document.addEventListener('DOMContentLoaded', () => {
    loadCorrectRowCounts();
});

document.addEventListener('DOMContentLoaded', () => {
    loadCorrectRowCounts();
});

</script>

</body>
</html>